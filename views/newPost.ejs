<%-include('partials/header')%>

<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">
      <div class="card shadow-lg border-0 bg-light">
        <div class="card-header bg-white border-bottom-0">
          <h2 class="card-title mb-0 text-dark">
            <i class="fas fa-plus-circle me-2 text-primary"></i>Create New Post
          </h2>
        </div>
        <div class="card-body p-4">
          <% if (typeof success !== 'undefined' && success){ %>
          <div
            class="alert alert-success alert-dismissible fade show"
            role="alert"
          >
            <i class="fas fa-check-circle me-2"></i><%= success %>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="alert"
            ></button>
          </div>
          <% } %> <% if (typeof error !== 'undefined' && error){ %>
          <div
            class="alert alert-danger alert-dismissible fade show"
            role="alert"
          >
            <i class="fas fa-exclamation-triangle me-2"></i><%= error %>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="alert"
            ></button>
          </div>
          <% } %>

          <form
            action="/posts/add"
            method="POST"
            enctype="multipart/form-data"
            id="postForm"
          >
            <div class="mb-4">
              <label for="title" class="form-label fw-bold text-dark">
                <i class="fas fa-heading me-2 text-primary"></i>Title
              </label>
              <input
                type="text"
                id="title"
                name="title"
                class="form-control form-control-lg border-dark"
                placeholder="Enter an engaging title for your post..."
                required
              />
              <div class="form-text text-muted">
                Choose a title that captures the essence of your content
              </div>
            </div>

            <div class="mb-4">
              <label for="content" class="form-label fw-bold text-dark">
                <i class="fas fa-edit me-2 text-primary"></i>Content
              </label>
              <textarea
                id="content"
                name="content"
                class="form-control border-dark"
                rows="8"
                placeholder="Write your post content here..."
                required
              ></textarea>
              <div class="form-text text-muted">
                Share your thoughts, stories, or insights
              </div>
            </div>

            <div class="mb-4">
              <label for="images" class="form-label fw-bold text-dark">
                <i class="fas fa-images me-2 text-primary"></i>Images
              </label>
              <input
                type="file"
                id="images"
                name="images"
                class="form-control border-dark"
                multiple
                accept="image/*"
                onchange="previewImages()"
              />
              <div class="form-text text-muted">
                Select one or more images (JPG, PNG, GIF). Maximum 5 images
                allowed.
              </div>
              <div id="imagePreview" class="mt-3 d-none">
                <h6 class="text-dark">Selected Images:</h6>
                <div id="previewContainer" class="d-flex flex-wrap gap-2"></div>
              </div>
            </div>

            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
              <a href="/posts" class="btn btn-outline-dark me-md-2">
                <i class="fas fa-arrow-left me-2"></i>Cancel
              </a>
              <button
                type="submit"
                class="btn btn-primary btn-lg"
                id="submitBtn"
              >
                <i class="fas fa-paper-plane me-2"></i>Publish Post
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  <script>
    function previewImages() {
      const previewContainer = document.getElementById("previewContainer");
      const imagePreview = document.getElementById("imagePreview");
      previewContainer.innerHTML = "";
      const files = document.getElementById("images").files;

      if (files && files.length > 0) {
        imagePreview.classList.remove("d-none");
        for (let i = 0; i < files.length; i++) {
          const file = files[i];
          if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function(e) {
              const imgDiv = document.createElement('div');
              imgDiv.className = 'position-relative d-inline-block me-2 mb-2';
              imgDiv.innerHTML = `
                <img src="${e.target.result}" class="img-thumbnail" style="width: 100px; height: 100px; object-fit: cover;" alt="Preview ${i + 1}">
                <button type="button" class="btn btn-sm btn-danger position-absolute top-0 end-0" onclick="removeImage(${i})" style="width: 20px; height: 20px; padding: 0; border-radius: 50%; font-size: 12px;">
                  <i class="fas fa-times"></i>
                </button>
              `;
              previewContainer.appendChild(imgDiv);
            };
            reader.readAsDataURL(file);
          }
        }
      } else {
        imagePreview.classList.add("d-none");
      }
    }

    function removeImage(index) {
      const input = document.getElementById('images');
      const dt = new DataTransfer();
      const files = Array.from(input.files);

      files.splice(index, 1);
      files.forEach(file => dt.items.add(file));
      input.files = dt.files;

      // Trigger change event to update preview
      previewImages();
    }

    // Form submission feedback
    document.getElementById('postForm').addEventListener('submit', function() {
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Publishing...';
      submitBtn.disabled = true;
    });
  </script>
</div>
<%-include('partials/footer')%>
